# Notes:
#
# port definitions for services are for debug/development, except the "80:80"
# for debug/development define moonspeak.test in /etc/hosts 
#
# For pdb debug add to service definition:
#   stdin_open: true  # docker run -i
#   tty: true         # docker run -t
# and run "docker attach CONTAINER_NAME"
#
#
version: "3.9"

networks:
  moonspeak-static:
    name: moonspeak-static
  moonspeak-dynamic:
    name: moonspeak-dynamic

services:
  #===================================
  # this service name is not hardcoded
  gateway.moonspeak.test:
    image: ms-gateway:latest
    build:
      context: ./gateway-nginx
    ports:
      - "80:80"
    networks:
      - moonspeak-static
    depends_on:
      - router.moonspeak.test

  router.moonspeak.test:
    image: ms-router:latest
    hostname: moonspeak.test
    build:
      context: ./forwarder
    volumes:
      - /opt/ms/tmp
    networks:
      - moonspeak-static
      - moonspeak-dynamic

  #===================================
  landing.moonspeak.test:
    image: ms-landing:latest
    build:
      context: ./landing
    networks:
      - moonspeak-static

  synonyms.moonspeak.test:
    image: ms-synonyms:latest
    build:
      context: ./synonyms
    volumes:
      - /opt/ms/tmp
    networks:
      - moonspeak-static

  suggestions.moonspeak.test:
    image: ms-suggestions:latest
    build:
      context: ./suggestions
    volumes:
      - /opt/ms/tmp
    networks:
      - moonspeak-static

  plugins.moonspeak.test:
    image: ms-plugins:latest
    build:
      context: ./plugins
    networks:
      - moonspeak-static

  plus.moonspeak.test:
    image: ms-plus:latest
    build:
      context: ./plus
    networks:
      - moonspeak-static

  help.moonspeak.test:
    image: ms-help:latest
    build:
      context: ./help
    networks:
      - moonspeak-static

  #===================================
  # this is the user's unique access url
  hud-aaa.moonspeak.test:
    image: ms-hud:latest
    build:
      context: ./hud
    volumes:
      - /opt/ms/tmp
      - type: bind
        source: ./hud/tmp
        target: /opt/ms/tmp
    networks:
      - moonspeak-dynamic

  grapheditor-bbb.moonspeak.test:
    image: ms-grapheditor:latest
    build:
      context: ./grapheditor
    volumes:
      - /opt/ms/tmp
    networks:
      - moonspeak-dynamic

  submit-ccc.moonspeak.test:
    image: ms-submit:latest
    build:
      context: ./submit
    volumes:
      - /opt/ms/tmp
    networks:
      - moonspeak-dynamic

  workelements-ddd.moonspeak.test:
    image: ms-workelements:latest
    build:
      context: ./workelements
    volumes:
      - /opt/ms/tmp
    networks:
      - moonspeak-dynamic
