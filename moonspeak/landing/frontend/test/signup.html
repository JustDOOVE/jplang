<!doctype html>
<html>
  <head>
      <meta charset="utf-8">
  </head>
  <body>
      <script src="../common/fast-toml.js"></script>
      <script src="../common/nunjucks.min.js"></script>
      <script type="application/javascript">
        async function main(basename) {
            let response = await fetch(basename + '.toml');
            let text = await response.text();
            let data = TOML.parse(text);
            nunjucks.configure('../common', { autoescape: false, throwOnUndefined: true });
            let rendered = nunjucks.render(basename + '.template', data);

            document.open();
            document.write(rendered);
            document.close();
        }

        // e.g. from "/test/index.html" we get basename == "index"
        let basename = window.location.pathname.split("/").pop(0).split(".")[0];
        main(basename);
      </script>
  </body>
</html>
